<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sdk

```go
import "github.com/faciam-dev/gcfm/sdk"
```

## Index

- [Variables](<#variables>)
- [func UnifiedDiff\(a, b string\) string](<#UnifiedDiff>)
- [type ApplyOptions](<#ApplyOptions>)
- [type DBConfig](<#DBConfig>)
- [type DiffReport](<#DiffReport>)
  - [func CalculateDiff\(changes \[\]registry.Change\) DiffReport](<#CalculateDiff>)
- [type DisplayMeta](<#DisplayMeta>)
- [type DisplayOptions](<#DisplayOptions>)
- [type FieldMeta](<#FieldMeta>)
- [type Service](<#Service>)
  - [func New\(cfg ServiceConfig\) Service](<#New>)
- [type ServiceConfig](<#ServiceConfig>)
- [type Snapshot](<#Snapshot>)
- [type SnapshotClient](<#SnapshotClient>)


## Variables

<a name="ErrValidatorNotFound"></a>ErrValidatorNotFound is returned when a validator plugin cannot be found.

```go
var (
    ErrValidatorNotFound = errors.New("validator not found")
)
```

<a name="UnifiedDiff"></a>
## func [UnifiedDiff](<https://github.com/faciam-dev/gcfm/blob/main/sdk/diff.go#L6>)

```go
func UnifiedDiff(a, b string) string
```

UnifiedDiff returns a unified diff string of two inputs.

<a name="ApplyOptions"></a>
## type [ApplyOptions](<https://github.com/faciam-dev/gcfm/blob/main/sdk/service.go#L67-L71>)



```go
type ApplyOptions struct {
    // DryRun skips applying changes and only computes the diff.
    DryRun bool
    Actor  string
}
```

<a name="DBConfig"></a>
## type [DBConfig](<https://github.com/faciam-dev/gcfm/blob/main/sdk/config.go#L12-L17>)

DBConfig specifies database connection parameters.

```go
type DBConfig struct {
    Driver      string // mysql|postgres|mongo
    DSN         string
    Schema      string
    TablePrefix string
}
```

<a name="DiffReport"></a>
## type [DiffReport](<https://github.com/faciam-dev/gcfm/blob/main/sdk/service.go#L73-L80>)



```go
type DiffReport struct {
    // Added is the number of newly created fields.
    Added int
    // Deleted is the number of removed fields.
    Deleted int
    // Updated is the number of modified fields.
    Updated int
}
```

<a name="CalculateDiff"></a>
### func [CalculateDiff](<https://github.com/faciam-dev/gcfm/blob/main/sdk/apply.go#L174>)

```go
func CalculateDiff(changes []registry.Change) DiffReport
```

CalculateDiff returns counts of added, deleted and updated changes.

<a name="DisplayMeta"></a>
## type [DisplayMeta](<https://github.com/faciam-dev/gcfm/blob/main/sdk/types.go#L11>)



```go
type DisplayMeta = registry.DisplayMeta
```

<a name="DisplayOptions"></a>
## type [DisplayOptions](<https://github.com/faciam-dev/gcfm/blob/main/sdk/types.go#L13>)



```go
type DisplayOptions = registry.DisplayOption
```

<a name="FieldMeta"></a>
## type [FieldMeta](<https://github.com/faciam-dev/gcfm/blob/main/sdk/types.go#L9>)



```go
type FieldMeta = registry.FieldMeta
```

<a name="Service"></a>
## type [Service](<https://github.com/faciam-dev/gcfm/blob/main/sdk/service.go#L17-L36>)

Service exposes high level operations for custom field registry. Service provides database operations for custom field registry.

```go
type Service interface {
    // Scan reads schema information from the database.
    Scan(ctx context.Context, cfg DBConfig) ([]registry.FieldMeta, error)
    // Export dumps registry metadata as YAML.
    Export(ctx context.Context, cfg DBConfig) ([]byte, error)
    // Apply updates the registry based on the provided YAML.
    Apply(ctx context.Context, cfg DBConfig, yaml []byte, opts ApplyOptions) (DiffReport, error)
    // MigrateRegistry upgrades or downgrades the registry schema.
    MigrateRegistry(ctx context.Context, cfg DBConfig, target int) error
    // RegistryVersion returns the current registry schema version.
    RegistryVersion(ctx context.Context, cfg DBConfig) (int, error)
    // ListCustomFields returns custom field metadata.
    ListCustomFields(ctx context.Context, table string) ([]registry.FieldMeta, error)
    // CreateCustomField inserts a new field into the registry.
    CreateCustomField(ctx context.Context, fm registry.FieldMeta) error
    // UpdateCustomField modifies an existing field.
    UpdateCustomField(ctx context.Context, fm registry.FieldMeta) error
    // DeleteCustomField removes a field from the registry.
    DeleteCustomField(ctx context.Context, table, column string) error
}
```

<details><summary>Example (Quickstart)</summary>
<p>



```go
package main

import (
	"context"
	"log"

	"github.com/faciam-dev/gcfm/sdk"
)

func main() {
	ctx := context.Background()
	svc := sdk.New(sdk.ServiceConfig{})
	cfg := sdk.DBConfig{
		DSN:    "mysql://user:pass@tcp(localhost:3306)/app",
		Schema: "app",
	}

	yaml, err := svc.Export(ctx, cfg)
	if err != nil {
		log.Fatal(err)
	}

	if _, err := svc.Apply(ctx, cfg, yaml, sdk.ApplyOptions{DryRun: true}); err != nil {
		log.Fatal(err)
	}

	if err := svc.MigrateRegistry(ctx, cfg, 0); err != nil {
		log.Fatal(err)
	}
}
```

</p>
</details>

<a name="New"></a>
### func [New](<https://github.com/faciam-dev/gcfm/blob/main/sdk/service.go#L40>)

```go
func New(cfg ServiceConfig) Service
```

New returns a Service initialized with the given configuration. Validator plugins under PluginDir are loaded automatically.

<a name="ServiceConfig"></a>
## type [ServiceConfig](<https://github.com/faciam-dev/gcfm/blob/main/sdk/config.go#L20-L30>)

ServiceConfig holds optional configuration for Service.

```go
type ServiceConfig struct {
    Logger          *zap.SugaredLogger
    PluginDir       string
    PluginPublicKey string
    PluginEnabled   *bool
    Recorder        *audit.Recorder
    Notifier        notifier.Broker
    DB              *sql.DB
    Driver          string
    Schema          string
}
```

<a name="Snapshot"></a>
## type [Snapshot](<https://github.com/faciam-dev/gcfm/blob/main/sdk/types.go#L16-L21>)

Snapshot describes a stored registry snapshot.

```go
type Snapshot struct {
    ID      int64
    Semver  string
    TakenAt time.Time
    Author  string
}
```

<a name="SnapshotClient"></a>
## type [SnapshotClient](<https://github.com/faciam-dev/gcfm/blob/main/sdk/snapshot_client.go#L6-L11>)

SnapshotClient provides snapshot operations.

```go
type SnapshotClient interface {
    List(ctx context.Context, tenant string) ([]Snapshot, error)
    Create(ctx context.Context, tenant, bump, msg string) (Snapshot, error)
    Apply(ctx context.Context, tenant, ver string) error
    Diff(ctx context.Context, tenant, from, to string) (string, error)
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
