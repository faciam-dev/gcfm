<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# sdk

```go
import "github.com/faciam-dev/gcfm/sdk"
```

## Index

- [Variables](<#variables>)
- [type ApplyOptions](<#ApplyOptions>)
- [type DBConfig](<#DBConfig>)
- [type DiffReport](<#DiffReport>)
  - [func CalculateDiff\(changes \[\]registry.Change\) DiffReport](<#CalculateDiff>)
- [type Service](<#Service>)
  - [func New\(cfg ServiceConfig\) Service](<#New>)
- [type ServiceConfig](<#ServiceConfig>)


## Variables

<a name="ErrValidatorNotFound"></a>ErrValidatorNotFound is returned when a validator plugin cannot be found.

```go
var (
    ErrValidatorNotFound = errors.New("validator not found")
)
```

<a name="ApplyOptions"></a>
## type ApplyOptions



```go
type ApplyOptions struct {
    // DryRun skips applying changes and only computes the diff.
    DryRun bool
}
```

<a name="DBConfig"></a>
## type DBConfig

DBConfig specifies database connection parameters.

```go
type DBConfig struct {
    Driver string // mysql|postgres|mongo
    DSN    string
    Schema string
}
```

<a name="DiffReport"></a>
## type DiffReport



```go
type DiffReport struct {
    // Added is the number of newly created fields.
    Added int
    // Deleted is the number of removed fields.
    Deleted int
    // Updated is the number of modified fields.
    Updated int
}
```

<a name="CalculateDiff"></a>
### func CalculateDiff

```go
func CalculateDiff(changes []registry.Change) DiffReport
```

CalculateDiff returns counts of added, deleted and updated changes.

<a name="Service"></a>
## type Service

Service exposes high level operations for custom field registry. Service provides database operations for custom field registry.

```go
type Service interface {
    // Scan reads schema information from the database.
    Scan(ctx context.Context, cfg DBConfig) ([]registry.FieldMeta, error)
    // Export dumps registry metadata as YAML.
    Export(ctx context.Context, cfg DBConfig) ([]byte, error)
    // Apply updates the registry based on the provided YAML.
    Apply(ctx context.Context, cfg DBConfig, yaml []byte, opts ApplyOptions) (DiffReport, error)
    // MigrateRegistry upgrades or downgrades the registry schema.
    MigrateRegistry(ctx context.Context, cfg DBConfig, target int) error
    // RegistryVersion returns the current registry schema version.
    RegistryVersion(ctx context.Context, cfg DBConfig) (int, error)
}
```

<details><summary>Example (Quickstart)</summary>
<p>



```go
package main

import (
	"context"
	"log"

	"github.com/faciam-dev/gcfm/sdk"
)

func main() {
	ctx := context.Background()
	svc := sdk.New(sdk.ServiceConfig{})
	cfg := sdk.DBConfig{
		DSN:    "mysql://user:pass@tcp(localhost:3306)/app",
		Schema: "app",
	}

	yaml, err := svc.Export(ctx, cfg)
	if err != nil {
		log.Fatal(err)
	}

	if _, err := svc.Apply(ctx, cfg, yaml, sdk.ApplyOptions{DryRun: true}); err != nil {
		log.Fatal(err)
	}

	if err := svc.MigrateRegistry(ctx, cfg, 0); err != nil {
		log.Fatal(err)
	}
}
```

</p>
</details>

<a name="New"></a>
### func New

```go
func New(cfg ServiceConfig) Service
```

New returns a Service initialized with the given configuration. Validator plugins under PluginDir are loaded automatically.

<a name="ServiceConfig"></a>
## type ServiceConfig

ServiceConfig holds optional configuration for Service.

```go
type ServiceConfig struct {
    Logger    *zap.SugaredLogger
    PluginDir string
}
```

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
